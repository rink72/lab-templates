---
parameters:
  cloudType: ""
  service: ""
  gcpKeyData: ""
  keyPath: "key.json"
  timeout: 90

steps:
  - pwsh: |
      (echo '${{ parameters.gcpKeyData }}' | base64 -d) > ${{ parameters.keyPath }}
      $env:GOOGLE_APPLICATION_CREDENTIALS = '${{ parameters.keyPath }}'

      gcloud auth activate-service-account --quiet --key-file ${{ parameters.keyPath }}

      $(Pipeline.Workspace)/s/terragrunt/scripts/Deploy-GCPTerragruntConfig.ps1 `
        -Service ${{ parameters.service }}
    displayName: Deploy
    env:
      SERVICE: ${{ parameters.service }}
